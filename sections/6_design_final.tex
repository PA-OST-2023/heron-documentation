\chapter{Final Design}
\section{Overview}
This section covers the complete development process including the hardware, gateware, software and mechanical design of the project. It is important to note that the following documentation concentrates only on the final version of the device. Earlier hardware prototypes are not covered due to the lack of relevance.

\subsection{Key Requirements}
The main focus of the development is to design a professional looking, easy to use and eye-catching device for demonstration purposes. The project name \textit{Audio-Beamformer} has been chosen as it is easy to remember and has potential to be seen as a trademark.

The following key requirements have been set:
\begin{itemize}
	\item Single power adapter or power cable (e.g. no need of labor power supplies)
	\item Easy to install (e.g. montage on a camera tripod)
	\item Intuitive to operate via state-of-the-art graphical user interface
	\item Multiple audio streaming sources such as Bluetooth and USB input devices
	\item Great scalability and flexibility of the hardware and software design
\end{itemize}

\subsection{Key Decisions}
In the conceptional phase of the development, several key decisions had to be made. This contains mainly the signal flow and the division between the processing part on the Raspberry Pi and the \acrshort{fpga}. Further, the question had to be evaluated, if a built-in power supply or an external power adapter is preferred. And most importantly, which type of ultrasonic transducer should be used in the design.
In addition, the overall dimension and scale of the final product had to be discussed.
In general, most of these decisions were made according to results of simulations, physical measurements and after extensive discussions.
In the following sections, each part of the project is explained in detail.

\newpage
\section{Mechanical Design}
Blabla




\newpage
\section{Hardware Design}
Blabla

\subsection{Block Diagram}

\subsection{Power Supply}

% TODO: Add power supply block diagram

\subsubsection{Power over Ethernet (PoE)}


\subsection{Microcontroller Unit (MCU)}

%  TODO: Write about external PSRAM

\subsection{Audio Input}

\subsubsection{GNSS}

\subsection{Human Machine Interface (HMI)}

%  TODO: Wite about LEDs and Buzzer

\subsubsection{LCD Display}

\subsubsection{RGB LEDs}

\subsection{Sensors}

\subsubsection{Magnetometer \& Accelerometer Sensor}

\subsubsection{Ambient Pressure \& Temperature Sensor}

\subsubsection{Angle Sensor}

\subsection{Printed Circuit Board (PCB)}

\subsubsection{Mainboard}

\subsubsection{Microphone Arms}

\subsubsection{Angle Sensor}

\newpage
\section{Firmware Design}
Blabla

\subsection{Overview}
The firmware is written in C++ and is based on the Arduino framework that has been addopted to the Teensy microcontroller environment.
As an IDE, the VS Code extension PlatfromIO was used, as it provides powerful development tools and a great integration of the Arduino framework.


The firmware is divided into modules running in individual threads, facilitated by TeensyThreads on the Teensy 4.1 microcontroller.
This lightweight multitasking library allows for concurrent execution of multiple threads, optimizing system performance and resource utilization.
TeensyThreads' minimal memory footprint and efficient CPU usage are critical in embedded systems where resources are constrained.

%  table of all threads and their purpose
% \begin{table}[h]
% \centering
% \begin{tabular}{|l|l|}
% 	\hline
% 	Thread                     & Purpose                      \\ \hline
% 	\texttt{Console Interface} & Handles USB virtual COM-Port \\ \hline
% 	\texttt{Console Streaming} & Handles queing of messages   \\ \hline

% 	\texttt{main}              & Main thread                  \\ \hline
% \end{tabular}
% \caption{Overview of all threads and their purpose}
% \label{tab:threads}


\subsection{Audio Streaming}

\subsubsection{Remote Configuration}

\subsection{Sensor Calibration}



\subsection{Grphical User Interface (GUI)}

\subsubsection{Light and Versatile Embedded Graphics Library (LVGL)}




\newpage
\section{Software Design}
Blabla




